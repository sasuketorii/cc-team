# Claude Code è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èªè¨¼å•é¡Œèª¿æŸ»å ±å‘Šæ›¸

ä½œæˆæ—¥æ™‚: 2025å¹´01æœˆ09æ—¥ 20æ™‚55åˆ†46ç§’ (JST)
ä½œæˆè€…: CCTeam
ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 0.0.7

---

## ðŸ“‹ æ¦‚è¦

CCTeamãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã„ã¦ã€Claude Code CLIã‚’è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆBossÃ—1 + WorkerÃ—3ï¼‰ã§èµ·å‹•ã™ã‚‹éš›ã«ç™ºç”Ÿã™ã‚‹èªè¨¼ãƒãƒ¼ãƒˆç«¶åˆå•é¡Œï¼ˆPort 54545ï¼‰ã®èª¿æŸ»ã¨ã€tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³æ§‹æˆãŠã‚ˆã³Git worktreeä¸¦åˆ—é–‹ç™ºã«é–¢ã™ã‚‹æŠ€è¡“çš„ãªåˆ†æžã‚’è¡Œã„ã¾ã—ãŸã€‚

## ðŸ” èª¿æŸ»çµæžœ

### 1. Port 54545èªè¨¼ã‚¨ãƒ©ãƒ¼ã®æ ¹æœ¬åŽŸå› 

#### ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
```
Auth error: Port 54545 is already in use. Please ensure no other applications are using this port.
```

#### æŠ€è¡“çš„åˆ†æž
1. **OAuth 2.0èªè¨¼ãƒ•ãƒ­ãƒ¼ã®åˆ¶ç´„**
   - Claude Code CLIã¯OAuth 2.0ã®Authorization Code Flowã‚’ä½¿ç”¨
   - èªè¨¼æ™‚ã«ãƒ­ãƒ¼ã‚«ãƒ«ãƒ›ã‚¹ãƒˆï¼ˆlocalhostï¼‰ã®ãƒãƒ¼ãƒˆ54545ã§ä¸€æ™‚çš„ãªWebã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
   - ã“ã®ãƒãƒ¼ãƒˆç•ªå·ã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…ã«ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ãŠã‚Šã€å¤‰æ›´ä¸å¯

2. **ãƒãƒ¼ãƒˆç«¶åˆã®ç™ºç”Ÿãƒ¡ã‚«ãƒ‹ã‚ºãƒ **
   ```
   Bossèµ·å‹• â†’ Port 54545ã‚’å æœ‰ â†’ èªè¨¼é–‹å§‹
   Worker1èµ·å‹• â†’ Port 54545ã«ã‚¢ã‚¯ã‚»ã‚¹è©¦è¡Œ â†’ ã‚¨ãƒ©ãƒ¼ï¼ˆæ—¢ã«ä½¿ç”¨ä¸­ï¼‰
   Worker2, Worker3ã‚‚åŒæ§˜ã«å¤±æ•—
   ```

3. **æ—¢çŸ¥ã®å•é¡Œ**
   - GitHub Issue #2586: "OAuth port 54545 conflicts with macOS mobileactivationd"
   - Anthropicã«ã‚ˆã£ã¦ãƒã‚°ã¨ã—ã¦èªè­˜ã•ã‚Œã¦ã„ã‚‹ãŒã€ç¾æ™‚ç‚¹ã§ä¿®æ­£ãªã—

### 2. è§£æ±ºç­–ï¼šDockerã«ã‚ˆã‚‹é †æ¬¡èªè¨¼ãƒ»ä¸¦åˆ—é‹ç”¨æˆ¦ç•¥

#### æŽ¨å¥¨ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
**ãƒ•ã‚§ãƒ¼ã‚º1: é †æ¬¡èªè¨¼ï¼ˆState Generationï¼‰**
```bash
# 1. Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ä½œæˆ
docker build -t claude-agent:latest .

# 2. å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®é †æ¬¡èªè¨¼
./authenticate_agent.sh boss
./authenticate_agent.sh worker1
./authenticate_agent.sh worker2
./authenticate_agent.sh worker3
```

**ãƒ•ã‚§ãƒ¼ã‚º2: ä¸¦åˆ—é‹ç”¨ï¼ˆOperationï¼‰**
```yaml
# docker-compose.yml
version: '3.8'
services:
  boss:
    image: claude-agent:latest
    volumes:
      - ./claude_config/boss:/root/.claude
    networks:
      - claude-net
  worker1:
    image: claude-agent:latest
    volumes:
      - ./claude_config/worker1:/root/.claude
    networks:
      - claude-net
  # worker2, worker3ã‚‚åŒæ§˜
```

#### å®Ÿè£…æ‰‹é †
1. å„ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ç‹¬ç«‹ã—ãŸDockerã‚³ãƒ³ãƒ†ãƒŠã§é †ç•ªã«èªè¨¼
2. èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ãƒ›ã‚¹ãƒˆãƒžã‚·ãƒ³ã«ä¿å­˜
3. docker-composeã§å…¨ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’èªè¨¼æ¸ˆã¿çŠ¶æ…‹ã§ä¸¦åˆ—èµ·å‹•

### 3. tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³æ§‹æˆã«é–¢ã™ã‚‹å›žç­”

#### è³ªå•1ã¸ã®å›žç­”ï¼štmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ç‹¬ç«‹æ€§

**å›žç­”ï¼šã„ã„ãˆã€åŒä¸€äººç‰©ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚**

ç¾åœ¨ã®CCTeamã®å®Ÿè£…ã§ã¯ï¼š
- `ccteam-boss`ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆ2ç”»é¢ï¼šBoss | Geminiï¼‰
- `ccteam`ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆ4ç”»é¢ï¼šBoss | Worker1 | Worker2 | Worker3ï¼‰

ã“ã‚Œã‚‰ã¯**å®Œå…¨ã«ç‹¬ç«‹ã—ãŸtmuxã‚»ãƒƒã‚·ãƒ§ãƒ³**ã§ã™ã€‚

```bash
# ç¢ºèªæ–¹æ³•
tmux ls
# å‡ºåŠ›ä¾‹ï¼š
# ccteam: 4 windows (created Thu Jan 9 15:00:00 2025) [160x50]
# ccteam-boss: 2 windows (created Thu Jan 9 15:01:00 2025) [160x50]
```

**æŠ€è¡“çš„è©³ç´°ï¼š**
- å„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ç‹¬ç«‹ã—ãŸãƒ—ãƒ­ã‚»ã‚¹ç©ºé–“ã‚’æŒã¤
- ä¸€æ–¹ã®Bossã¸ã®æŒ‡ç¤ºã¯ã€ä»–æ–¹ã®Bossã«ã¯åæ˜ ã•ã‚Œãªã„
- åŒã˜Claudeèªè¨¼æƒ…å ±ã‚’ä½¿ç”¨ã—ã¦ã„ã¦ã‚‚ã€åˆ¥ã€…ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹

### 4. Git worktreeã«é–¢ã™ã‚‹å›žç­”

#### è³ªå•2ã¸ã®å›žç­”ï¼šworktreeã®æ§‹æˆå˜ä½

**å›žç­”ï¼š1ä¸¦åˆ— = 1çµ„ç¹”ï¼ˆBossÃ—1 + WorkerÃ—3 + GeminiÃ—1ï¼‰ã§ã™ã€‚**

```
main/              # ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ©ãƒ³ãƒ
â”œâ”€â”€ Boss
â”œâ”€â”€ Worker1
â”œâ”€â”€ Worker2
â”œâ”€â”€ Worker3
â””â”€â”€ Gemini

worktree/feature-a/  # ä¸¦åˆ—é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒ
â”œâ”€â”€ Bossï¼ˆåˆ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
â”œâ”€â”€ Worker1ï¼ˆåˆ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
â”œâ”€â”€ Worker2ï¼ˆåˆ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
â”œâ”€â”€ Worker3ï¼ˆåˆ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
â””â”€â”€ Geminiï¼ˆåˆ¥ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰
```

**2ä¸¦åˆ—ã®å ´åˆï¼š**
- åˆè¨ˆï¼š5å Ã— 2 = **10åã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**ãŒç¨¼åƒ
- å„worktreeã§ç‹¬ç«‹ã—ãŸçµ„ç¹”ãŒå‹•ä½œ
- ãƒ–ãƒ©ãƒ³ãƒé–“ã®å¹²æ¸‰ãªã—

#### è³ªå•3ã¸ã®å›žç­”ï¼šworktreeã®è‡ªå‹•ä¸¦åˆ—åˆ¤æ–­

**å›žç­”ï¼šã„ã„ãˆã€è‡ªå‹•ã§ã¯åˆ¤æ–­ã—ã¾ã›ã‚“ã€‚æ‰‹å‹•ã§ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚**

ç¾åœ¨ã®CCTeamã§ã¯ï¼š
1. **æ‰‹å‹•ã§worktreeã‚’ä½œæˆ**
   ```bash
   git worktree add ../worktrees/feature-x feature-x
   ```

2. **æ‰‹å‹•ã§å„worktreeã§CCTeamã‚’èµ·å‹•**
   ```bash
   cd ../worktrees/feature-x
   ./scripts/launch-ccteam.sh
   ```

3. **å°†æ¥çš„ãªè‡ªå‹•åŒ–ã®å¯èƒ½æ€§**
   - ã‚¿ã‚¹ã‚¯ã®è¤‡é›‘åº¦ã‚’åˆ†æžã—ã¦è‡ªå‹•åˆ†å²
   - ç«¶åˆæ¤œå‡ºã«ã‚ˆã‚‹è‡ªå‹•worktreeä½œæˆ
   - ã—ã‹ã—ç¾æ™‚ç‚¹ã§ã¯æœªå®Ÿè£…

## ðŸ’¡ ææ¡ˆãƒ»æ”¹å–„ç­–

### çŸ­æœŸçš„å¯¾ç­–

1. **èªè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè£…**
   ```bash
   #!/bin/bash
   # scripts/docker_auth_setup.sh
   
   # Dockerfileã®ä½œæˆ
   cat > Dockerfile << 'EOF'
   FROM node:18-slim
   WORKDIR /app
   RUN npm install -g @anthropic-ai/claude-code --unsafe-perm
   CMD ["bash"]
   EOF
   
   # ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
   docker build -t claude-agent:latest .
   
   # é †æ¬¡èªè¨¼
   for agent in boss worker1 worker2 worker3; do
     echo "Authenticating $agent..."
     ./authenticate_agent.sh $agent
   done
   ```

2. **tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã®æ”¹å–„**
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³åã®æ˜Žç¢ºåŒ–
   - çµ±ä¸€ç®¡ç†ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆ

### é•·æœŸçš„å¯¾ç­–

1. **Anthropicã¸ã®åƒãã‹ã‘**
   - Issue #2586ã®ãƒ•ã‚©ãƒ­ãƒ¼ã‚¢ãƒƒãƒ—
   - ãƒãƒ¼ãƒˆè¨­å®šå¯èƒ½æ€§ã®è¦æœ›

2. **ä¸¦åˆ—é–‹ç™ºã®è‡ªå‹•åŒ–**
   - worktreeè‡ªå‹•ä½œæˆã‚·ã‚¹ãƒ†ãƒ 
   - ã‚¿ã‚¹ã‚¯åˆ†æžã«ã‚ˆã‚‹ä¸¦åˆ—åˆ¤æ–­AI

## ðŸ“ˆ å®Ÿè£…è¨ˆç”»

| ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | æœŸé–“ | å„ªå…ˆåº¦ |
|---------|------|------|--------|
| Phase 1 | Dockerèªè¨¼ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰ | 3æ—¥ | é«˜ |
| Phase 2 | tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³çµ±åˆç®¡ç† | 1é€±é–“ | ä¸­ |
| Phase 3 | worktreeè‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ  | 2é€±é–“ | ä½Ž |

## ðŸš€ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. Dockerèªè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½œæˆã¨å®Ÿè£…
2. tmuxã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ä½œæˆ
3. worktreeä¸¦åˆ—é–‹ç™ºã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ç­–å®š

## ðŸ“Ž å‚è€ƒè³‡æ–™

- [Claude Code GitHub Issues](https://github.com/anthropics/claude-code/issues)
- [Docker Network Documentation](https://docs.docker.com/network/)
- [Git Worktree Documentation](https://git-scm.com/docs/git-worktree)
- æä¾›è³‡æ–™: CluadeCodeèªè¨¼ã‚¨ãƒ©ãƒ¼è§£æ¶ˆ.txt

---

## æ›´æ–°å±¥æ­´

- 2025å¹´01æœˆ09æ—¥ 20æ™‚55åˆ†46ç§’ (JST): åˆç‰ˆä½œæˆ