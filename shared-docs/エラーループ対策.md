# ClaudeCode エラーループ防止ガイド

## 概要
ClaudeCodeが複雑なエラーにはまり込んで永遠に抜け出せなくなる問題への対処法

## エラーループの兆候
- 同じエラーメッセージが3回以上続く
- 修正を試みても状況が改善しない
- 異なる修正アプローチでも同じ結果になる

## 🚨 自動検出システム
CCTeamには`error_loop_detector.py`が実装されており、同じエラーが3回続くと自動的に以下の指示が送信されます。

## 対処法（建設的アプローチ）

### 1. 即座にコード修正を停止 ⛔
```
「エラーループに入ったようです。コード修正は一旦禁止します。」
```

### 2. 状況整理を指示 📋
```
「以下の点を整理してください：
1. 現在のエラーの内容を箇条書きで整理
2. これまで試した修正方法をリストアップ
3. なぜ修正が効かないのか仮説を立てる」
```

### 3. 類似エラーの調査 🔍
```
「このエラーについて以下を調査してください：
1. エラーメッセージで検索して類似事例を探す
2. Stack Overflow、GitHub Issues、公式ドキュメントを確認
3. 別の解決アプローチを3つ以上見つける」
```

### 4. ドキュメント確認 📚
```
「関連ドキュメントを確認してください：
1. 使用しているライブラリ/フレームワークの公式ドキュメント
2. APIの仕様や制限事項
3. バージョン互換性の問題」
```

### 5. 不明点の明確化 ❓
```
「理解できていない部分を明確にしてください：
1. 質問形式でリストアップ
2. BOSSまたは他のWorkerに質問する内容を準備
3. 問題の本質を改めて定義」
```

## エラーループからの脱出手順

### フェーズ1: 調査と理解（コード修正禁止）
1. エラーメッセージの完全な理解
2. 関連ドキュメントの熟読
3. 類似事例の収集（最低3つ）
4. 不明点のリストアップ

### フェーズ2: 計画立案
1. 収集した情報を基に新しいアプローチを設計
2. 段階的な実装計画を作成
3. 各段階での検証方法を定義

### フェーズ3: 慎重な実装
1. 最小限の変更から開始
2. 各変更後に必ず動作確認
3. エラーが再発したら即座に停止

## ベストプラクティス

### やってはいけないこと ❌
- 同じ修正を何度も繰り返す
- エラーメッセージを読まずに修正する
- 大きな変更を一度に行う
- ドキュメントを確認せずに推測で修正する

### やるべきこと ✅
- エラーメッセージを完全に理解する
- 小さな変更を段階的に行う
- 各変更の影響を予測する
- 不明な点は調査または質問する

## 予防策

### プロジェクト開始時
1. 小さな変更から始める
2. 頻繁に動作確認を行う
3. バージョン管理を活用

### 開発中
1. 大きな変更は避ける
2. テストを先に書く
3. エラーメッセージを注意深く読む

## Workerエージェントへの指示例

```bash
# エラーループ検出時
./scripts/agent-send.sh worker1 "同じエラーが3回続いています。修正を一旦停止し、エラーの根本原因を分析してください"

# 段階的修正の指示
./scripts/agent-send.sh worker2 "エラーループ回避のため、最小限の修正から始めてください。まず1つの関数のみ修正して動作確認をお願いします"
```

## 関連リンク
- [Claude Code Common Workflows](https://docs.anthropic.com/en/docs/claude-code/common-workflows)
- Git worktreeを使った並列開発での問題切り分け

## 更新履歴
- 2024-01-XX: 初版作成