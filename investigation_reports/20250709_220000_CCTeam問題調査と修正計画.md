# CCTeam問題調査と修正計画

作成日時: 2025年07月09日 22時00分00秒

## 調査で判明した問題点

### 1. Geminiプロンプト送信問題 ❌
- **現状**: tmux send-keysで直接送信しているが、Enterキーが効いていない
- **原因**: Geminiが起動していない状態でメッセージを送信している可能性

### 2. tmuxペイン識別問題 ❌
- **現状**: 誰がBoss/Worker1/2/3か判断できない
- **原因**: Claudeが自動的にペインタイトルを上書きしている
- **影響**: bsshコマンドや異なるメッセージが表示されている

### 3. Boss重複問題（最重要） ❌
- **現状**: ccteamとccteam-bossで別々のBossインスタンスが起動
- **原因**: 両セッションで独立してclaudeコマンドを実行
- **影響**: 2画面と4画面のBossが別人格になっている

### 4. 承認フロー問題 ❌
- **現状**: Bossが各Workerの出力を確認できていない
- **原因**: 承認メカニズムが未実装
- **影響**: 各Workerが独立して動作し、管理されていない

### 5. デフォルト設定問題 ❌
- **現状**: デフォルトがユーザー承認モード
- **要望**: デフォルトは全自動モード

## 修正ToDoステップ

### Phase 1: アーキテクチャの再設計 🏗️

#### Option A: Boss統合案（推奨）
1. ccteam-bossセッションを廃止
2. Boss+Geminiをccteamセッション内に統合（5ペイン構成）
3. または、Geminiを独立セッションに移動

#### Option B: Worker専用案
1. ccteamセッションをWorker1-3のみの3分割に変更
2. Boss+Geminiは別セッション（ccteam-boss）で管理
3. agent-send.shでBossへの送信先を統一

### Phase 2: 即時修正項目 🔧

1. **Geminiプロンプト送信修正**
   ```bash
   # 修正前
   tmux send-keys -t ccteam-boss:main.1 "$GEMINI_INSTRUCTION" C-m
   
   # 修正後（agent-send.sh経由）
   ./scripts/agent-send.sh gemini "$GEMINI_INSTRUCTION" > /dev/null 2>&1
   ```

2. **ペイン識別表示の追加**
   - 各エージェントの初期メッセージに役割を明記
   - ステータスラインにエージェント名を表示

3. **デフォルト承認モードの変更**
   - 全自動モードをデフォルトに
   - ユーザー承認モードはオプション

### Phase 3: 承認システムの実装 🤝

1. **Boss監視システム**
   - 各Workerの出力をBossが定期的に確認
   - 承認/否認の判断ロジック実装

2. **進捗報告システム**
   - Workerからの定期報告を義務化
   - タスク完了時の承認フロー

### Phase 4: セッション同期の解決 🔄

1. **単一Boss案（推奨）**
   - Bossは1つのセッションのみで起動
   - 必要に応じてtmuxペインを移動/複製

2. **プロキシ案**
   - メッセージ転送システムの実装
   - 両セッションのBossを同期

## 推奨実装順序

### 最優先事項
1. Boss重複問題の解決（Option A or B を選択）
2. デフォルト承認モードを全自動に変更
3. ペイン識別表示の改善

### 次優先事項
4. Geminiプロンプト送信修正
5. 承認システムの基本実装

### 将来対応
6. 完全な承認フローシステム
7. 進捗管理システム

## アーキテクチャ選択の提案

### 🌟 推奨: Option A-2（Gemini独立案）

```
ccteam (4分割)
├── Boss (統合管理)
├── Worker1 (Frontend)
├── Worker2 (Backend)
└── Worker3 (Infra/Test)

ccteam-gemini (単独)
└── Gemini (AI相談役)
```

**メリット**:
- Bossの重複を完全に排除
- シンプルで分かりやすい構成
- 既存の4分割レイアウトを維持

**実装方法**:
1. ccteam-bossセッションを廃止
2. ccteam-geminiセッションを新規作成
3. agent-send.shを調整

この方式であれば、Boss重複問題を根本的に解決し、各エージェントの役割も明確になります。